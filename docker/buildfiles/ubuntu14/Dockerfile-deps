FROM hdbase:u14
MAINTAINER Nathan Sparks <nsparks@jlab.org>
RUN mkdir -p /home/gx && groupadd -r gx -g 573 && useradd -u 1000 \
    -r -g gx -d /home/gx -s /sbin/nologin -c "Docker image user" gx \
    && cd /home/gx \
    && curl -OL https://halldweb.jlab.org/dist/hdpm/hdpm-dev.linux.tar.gz \
    && tar xf hdpm-dev.linux.tar.gz && mv hdpm-dev/bin/hdpm /usr/bin/ \
    && rm -rf hdpm-dev hdpm-dev.linux.tar.gz && chown -R gx:gx /home/gx
USER gx
WORKDIR /home/gx
ENV CC=/usr/bin/clang-3.5 CXX=/usr/bin/clang++-3.5
RUN /bin/bash -c "hdpm fetch cernlib root amptools evio jana rcdb \
    && hdpm build cernlib root amptools evio jana rcdb \
    && hdpm clean --obliterate"
CMD /bin/bash
