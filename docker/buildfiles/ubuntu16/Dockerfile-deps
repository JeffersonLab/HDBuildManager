FROM hdbase:u16
MAINTAINER Nathan Sparks <nsparks@jlab.org>
RUN mkdir -p /home/gx && groupadd -r gx -g 573 && useradd -u 1000 \
    -r -g gx -d /home/gx -s /sbin/nologin -c "Docker image user" gx \
    && cd /home/gx \
    && curl -OL https://halldweb.jlab.org/dist/hdpm/hdpm-dev.linux.tar.gz \
    && tar xf hdpm-dev.linux.tar.gz && mv hdpm-dev/bin/hdpm /usr/bin/ \
    && rm -rf hdpm-dev hdpm-dev.linux.tar.gz && chown -R gx:gx /home/gx
USER gx
WORKDIR /home/gx
RUN /bin/bash -c "hdpm fetch -d cernlib root@binary amptools evio jana rcdb geant4 \
    && hdpm build cernlib amptools evio jana rcdb geant4 \
    && hdpm clean --obliterate --all"
CMD /bin/bash
